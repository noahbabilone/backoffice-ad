{% extends "ADBundle::layout.html.twig" %}


{% block title %}
    Dashboard - {{ parent() }}
{% endblock %}

{% block ad_body %}

    <div id="wrapper">
        <!-- Navigation -->
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12" style="margin-top: 12px;">
                    {#<h3 class="page-header">Dashboard</h3>#}
                    <ol class="breadcrumb">
                        <li><a href="{{ path("list_users") }}"><i class="fa fa-home fa-fw"></i></a></li>
                        <li class="active">Listes groupes</li>
                    </ol>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            {#{{ dump(groups) }}#}
            <div class="row">
                <div class="col-lg-12">
                    {% if result is defined and result %}
                        <div class="alert alert-success" role="alert">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            L'utulisateur a été ajouté avec succes .
                        </div>
                    {% endif %}

                    <div class="alert alert-success hide response-ajax">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        <span class="text-response-ajax"></span>
                    </div>

                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <i class="fa fa-users fa-fw"></i> Groupes
                            <div class="pull-right">
                                {#<a href="{{ path('add_user') }}" class="btn btn-success btn-xs"><i#}
                                {#class="fa fa-user fa-fw"></i>Ajouter un utilisateur</a>#}

                                {#<div class="btn-group">#}
                                {#<button type="button" class="btn btn-default btn-xs dropdown-toggle"#}
                                {#data-toggle="dropdown">#}
                                {#Afficher#}
                                {#<span class="caret"></span>#}
                                {#</button>#}
                                {#<ul class="dropdown-menu pull-right" role="menu">#}
                                {#<li><a href="{{ path('list_users') }}">Tout</a></li>#}
                                {#<li><a href="{{ path('users_by_ou',{'ou': 'Issy-Les-Moulineaux'}) }}">Issy Les#}
                                {#Moulineaux</a></li>#}
                                {#<li><a href="{{ path('users_by_ou',{'ou': 'Luxembourg'}) }}">Luxembourg</a></li>#}
                                {#<li><a href="{{ path('users_by_ou',{'ou': 'Saint-mande'}) }}">Saint Mande</a>#}
                                {#</li>#}
                                {#<li class="divider"></li>#}
                                {#<li><a href="{{ path('users_by_ou',{'ou': 'Compteutilisateur'}) }}">compte#}
                                {#utilsiateur</a>#}
                                {#</li>#}
                                {#</ul>#}
                                {#</div>#}

                            </div>

                        </div>
                        <!-- /.panel-heading -->
                        {% if groups is defined %}
                            <div class="panel-body">
                                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                    {% for  key, tab in groups %}
                                        {% for  group in tab %}
                                            {% if group|length >1 %}
                                                {% set groupTitle =ad_active_directory.getData(group,"cn") %}
                                                {% set arrayMembers =ad_active_directory.getArray(group,"member") %}

                                                <div class="panel panel-default">
                                                    <div class="panel-heading" role="tab" id="group-{{ key }}">
                                                        <a class="collapsed" role="button" data-toggle="collapse"
                                                           data-parent="#accordion" href="#control-{{ key }}"
                                                           aria-expanded="false"
                                                           aria-controls="control-{{ key }}">

                                                            <h6 class="panel-title">
                                                                {{ groupTitle }} <span
                                                                        class="badge pull-right">{{ arrayMembers| length -1 }}</span>
                                                            </h6>
                                                        </a>
                                                    </div>

                                                    <div id="control-{{ key }}" class="panel-collapse collapse"
                                                         role="tabpanel"
                                                         aria-labelledby="group-{{ key }}">
                                                        <div class="panel-body">
                                                            <div class="table-responsive">
                                                                <table class="table table-hover">
                                                                    <thead>
                                                                    <tr>
                                                                        <th class="col-md-2">Login</th>
                                                                        <th class="col-md-3">Nom</th>
                                                                        <th class="col-md-4">Email</th>
                                                                        <th class="col-md-1">Supprimer</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {#{{ dump(user) }}#}
                                                                    {% for  keyUser, userMemberDn in arrayMembers %}
                                                                        {% if  keyUser != "count" or keyUser =="0" %}

                                                                            {% set user =ad_active_directory.getUser(userMemberDn) %}
                                                                            {% set userName = ad_active_directory.getOneData(user,"samaccountname") %}

                                                                            <tr id="line-{{ groupTitle }}-{{ userName }}-{{ keyUser }}">
                                                                                <td class="col-md-2">{{ userName }}</td>
                                                                                <td class="col-md-3">{{ ad_active_directory.getOneData(user,"displayname") }}</td>
                                                                                <td class="col-md-4">{{ ad_active_directory.getOneData(user,"mail") }}</td>
                                                                                <td class="col-md-1 text-center">
                                                                                    <a href="#"
                                                                                       class="btn btn-xs btn-danger btn-remove-user-group"
                                                                                       id="{{ userName }}"
                                                                                       data-groupName="{{ groupTitle }}"
                                                                                       data-dnGroup="{{ ad_active_directory.getData(group,"distinguishedname") }}"
                                                                                       data-dnUser="{{ userMemberDn }}"
                                                                                       data-line="line-{{ groupTitle }}-{{ userName }}-{{ keyUser }}"><i
                                                                                                class="fa fa-remove fa-fw"></i></a>
                                                                                </td>
                                                                            </tr>
                                                                        {% endif %}

                                                                    {% else %}

                                                                    {% endfor %}
                                                                    </tbody>


                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        {% else %}
                                            Vide
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                                <!-- /.table-responsive -->
                            </div>
                            <!-- /.panel-body -->
                        {% else %}
                            Pas d'utilisateur trouvé.
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Modal -->
    <div class="modal fade" tabindex="-1" id="myModal" role="dialog">
        <div class="modal-dialog" role="document">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Suppression de l'utilisateur (<span id="username"></span>) du groupe (<span
                                id="groupName"></span>)</h4>
                </div>
                <div class="modal-body">
                    <p>Vous voulez vraiment supprimer cet utilisateur de ce groupe ?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger ok-delete-user-group" data-dismiss="modal">Oui</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Non</button>
                </div>
            </div>

        </div>
    </div>


{% endblock %}


